リポジトリ内ファイルの説明  
- mainMPUディレクトリ（製品本体として動作するソースコード、ArduinoIDE向け）
- security_chipディレクトリ（セキュリティチップ動作検証用、ArduinoIDE向け）
- gen_keytable.py（MPUとセキュリティチップの共通キーコード生成プログラム）

## コピーを防ぐための小さな工夫 ― セキュリティチップの検証と実験

個人でハードウェアの開発販売をしたり、その製品を取り扱っていただけるお店やサービスが沢山増えてきました。  
でもその一方で、海外などで勝手にコピーされて、大量生産されてしまうことがあります。  
せっかく頑張って作ったのに、コピー品が出回ってしまうのはとても悲しいことです。  
  
そこでこのリポジトリでは 『コピーされても動かにようにする仕組み』 を考え、小さなチップを使った実験を行いました。  
  
#### 実験に使ったもの 
- メインMPU(ESP32)
- セキュリティチップ(Arduino UNO)
  
この2つで検証と実験を行いました。  
ESP32が「製品本体」、Arduino UNOが「セキュリティチップ」という感じです。  
この仕組みはとてもシンプルで、UART（シリアル通信）で2本の線をつなぐだけで動作します。  
SPIやI2Cなど、他の通信方法にも応用できるように設計されています。  
  
#### どうやってコピーを防ぐの？
製品本体が起動するときに、「今回が何回目の起動か？」という情報をセキュリティチップに送ります。  
セキュリティチップはその回数に対応した「正しいカギ（キーコード）」を返します。  
製品本体はそれが合っているかを確認して、合っていれば起動します。  
このカギのデータはセキュリティチップの中だけに保存しておき、製品本体のプログラムだけでは起動できないようにします。  
これにより、基板がコピーされたり製品のアップデートファイルが不正に利用されたりしても、セキュリティチップの内容を非公開にしておけばコピー品が出回ることを防げるはずです。

### 他のチップにも使える？
今回のセキュリティチップのコードは、できるだけ汎用的な作りにしました。  
そのため、Arduinoだけでなく、小型のPICマイコン（6ピンや8ピンのシリーズ）にも移植しやすくなっています。  
部品数も最小限に抑えられるので、基板設計もしやすく、コストも低く抑えられます。

### 実装と実験の補足について
フローチャートとソースコードの間には、一部省略や簡略化の違いがあります。  
実際に自分で実装する際には、その部分を補完したり、より強固な設計にアレンジしてみてください。  
  

![フローチャート](flow.png)